<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¸Ø§ÛŒÙ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - CRM ÙØ§Ø±Ø³ÛŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.10.0/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glass-card {
            background: rgba(30, 30, 60, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .enhanced-card {
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }
        
        .enhanced-card:hover {
            transform: translateY(-5px) rotateX(5deg) rotateY(5deg);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.3);
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .animate-text {
            overflow: hidden;
        }
        
        .char {
            display: inline-block;
            transform: translateY(100px);
            opacity: 0;
        }
        
        .tilt-card {
            perspective: 1000px;
            transform-style: preserve-3d;
        }
        
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.6);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .enhanced-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .enhanced-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(139, 92, 246, 0.3);
            border-top: 4px solid #8B5CF6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-notification, .error-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .success-notification {
            background: #10B981;
        }
        
        .error-notification {
            background: #EF4444;
        }
        
        .ai-assistant-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .ai-assistant-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(139, 92, 246, 0.6);
        }
        
        .tasks-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .tasks-main {
            background: rgba(30, 30, 60, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            padding: 20px;
        }
        
        .tasks-sidebar {
            background: rgba(30, 30, 60, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            padding: 20px;
            height: fit-content;
        }
        
        .task-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-btn:hover {
            background: rgba(139, 92, 246, 0.3);
            transform: translateY(-1px);
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            border-color: transparent;
        }
        
        .task-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .task-column {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 15px;
            padding: 15px;
            min-height: 400px;
        }
        
        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .column-title {
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-count {
            background: rgba(139, 92, 246, 0.3);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .add-task-btn {
            background: rgba(139, 92, 246, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-task-btn:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: scale(1.1);
        }
        
        .task-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .task-card:hover {
            background: rgba(139, 92, 246, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.2);
        }
        
        .task-card.high-priority {
            border-left: 4px solid #EF4444;
        }
        
        .task-card.medium-priority {
            border-left: 4px solid #F59E0B;
        }
        
        .task-card.low-priority {
            border-left: 4px solid #10B981;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .task-title {
            font-weight: 600;
            color: white;
            flex: 1;
            margin-right: 10px;
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #8B5CF6;
            cursor: pointer;
        }
        
        .task-description {
            color: #A78BFA;
            font-size: 14px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-customer {
            font-size: 12px;
            color: #E0E7FF;
            background: rgba(139, 92, 246, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .task-due-date {
            font-size: 12px;
            color: #A78BFA;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .task-due-date.overdue {
            color: #EF4444;
        }
        
        .task-due-date.today {
            color: #F59E0B;
        }
        
        .task-progress {
            margin-bottom: 10px;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .task-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .task-tag {
            background: rgba(139, 92, 246, 0.2);
            color: #A78BFA;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 500;
        }
        
        .task-actions {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .task-card:hover .task-actions {
            opacity: 1;
        }
        
        .task-action-btn {
            background: rgba(139, 92, 246, 0.3);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 10px;
        }
        
        .task-action-btn:hover {
            background: rgba(139, 92, 246, 0.5);
            transform: scale(1.1);
        }
        
        .task-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #A78BFA;
        }
        
        .ai-insights {
            background: rgba(30, 30, 60, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .insight-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .insight-item:last-child {
            margin-bottom: 0;
        }
        
        .insight-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .insight-content {
            flex: 1;
        }
        
        .insight-title {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }
        
        .insight-description {
            font-size: 14px;
            color: #A78BFA;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-action-btn {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .quick-action-btn:hover {
            background: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .quick-action-btn i {
            font-size: 18px;
        }
        
        .task-form {
            background: rgba(30, 30, 60, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            color: #A78BFA;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: white;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: white;
            outline: none;
        }
        
        .form-select option {
            background: #1e1b4b;
            color: white;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .nav-item.active {
            background: rgba(139, 92, 246, 0.2);
            border-right: 3px solid #8B5CF6;
        }
        
        .smart-search {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 25px;
            padding: 10px 20px;
            color: white;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .smart-search:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .smart-search::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .theme-light {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
        }
        
        .theme-light .glass-card,
        .theme-light .tasks-main,
        .theme-light .tasks-sidebar,
        .theme-light .task-card,
        .theme-light .stat-card,
        .theme-light .ai-insights,
        .theme-light .task-form {
            background: rgba(255, 255, 255, 0.8);
            border-color: rgba(139, 92, 246, 0.1);
        }
        
        .theme-light .task-title,
        .theme-light .stat-value,
        .theme-light .insight-title,
        .theme-light h1,
        .theme-light h2,
        .theme-light h3,
        .theme-light h4 {
            color: #1e293b;
        }
        
        .theme-light .task-description,
        .theme-light .task-due-date,
        .theme-light .stat-label,
        .theme-light .insight-description,
        .theme-light .form-label {
            color: #64748b;
        }
        
        .theme-light .form-input,
        .theme-light .form-select,
        .theme-light .smart-search {
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            border-color: rgba(139, 92, 246, 0.2);
        }
        
        .theme-light .task-column {
            background: rgba(139, 92, 246, 0.05);
        }
        
        .theme-cosmic {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: white;
        }
        
        .page-content {
            transition: all 0.3s ease;
        }
        
        .loader-particles {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        
        .particle {
            width: 8px;
            height: 8px;
            background: #8B5CF6;
            border-radius: 50%;
            animation: particle-bounce 1.4s ease-in-out infinite both;
        }
        
        .particle:nth-child(1) { animation-delay: -0.32s; }
        .particle:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes particle-bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="theme-cosmic">
    <!-- Particle System Container -->
    <div id="particle-container"></div>
    
    <!-- Navigation -->
    <nav class="fixed top-0 right-0 w-64 h-full glass-card z-50">
        <div class="p-6">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full mx-auto mb-4 flex items-center justify-center text-2xl">
                    ğŸ‘‘
                </div>
                <h1 class="text-xl font-bold text-white">CRM ÙØ§Ø±Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
                <p class="text-sm text-gray-300">Ù†Ø³Ø®Ù‡ Û².Û° Ù‡ÙˆØ´Ù…Ù†Ø¯</p>
            </div>
            
            <div class="space-y-2">
                <a href="enhanced-dashboard.html" class="nav-item flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="dashboard">
                    <i class="fas fa-tachometer-alt ml-3"></i>
                    <span>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
                </a>
                <a href="enhanced-customers.html" class="nav-item flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="customers">
                    <i class="fas fa-users ml-3"></i>
                    <span>Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´ØªØ±ÛŒØ§Ù†</span>
                </a>
                <a href="enhanced-analytics.html" class="nav-item flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="analytics">
                    <i class="fas fa-chart-line ml-3"></i>
                    <span>ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
                </a>
                <a href="enhanced-calendar.html" class="nav-item flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="calendar">
                    <i class="fas fa-calendar-alt ml-3"></i>
                    <span>ØªÙ‚ÙˆÛŒÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
                </a>
                <a href="enhanced-tasks.html" class="nav-item active flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="tasks">
                    <i class="fas fa-tasks ml-3"></i>
                    <span>Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¸Ø§ÛŒÙ</span>
                </a>
                <a href="enhanced-settings.html" class="nav-item flex items-center p-3 rounded-lg text-white hover:bg-purple-500/20 transition-all" data-page="settings">
                    <i class="fas fa-cog ml-3"></i>
                    <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡</span>
                </a>
            </div>
            
            <!-- Theme Switcher -->
            <div class="mt-8 p-4 bg-purple-500/10 rounded-lg">
                <label class="block text-sm text-gray-300 mb-2">ØªÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡</label>
                <select class="theme-switcher w-full p-2 bg-purple-500/20 border border-purple-500/30 rounded text-white">
                    <option value="cosmic">Ú©ÛŒÙ‡Ø§Ù†ÛŒ</option>
                    <option value="light">Ø±ÙˆØ´Ù†</option>
                    <option value="dark">ØªÛŒØ±Ù‡</option>
                </select>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="mr-64 min-h-screen">
        <!-- Header -->
        <header class="glass-card p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-3xl font-bold text-white animate-text">Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¸Ø§ÛŒÙ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h2>
                    <p class="text-gray-300 mt-2">Ø³Ø§Ø²Ù…Ø§Ù†Ø¯Ù‡ÛŒ ÙˆØ¸Ø§ÛŒÙ Ø¨Ø§ Ù‚Ø¯Ø±Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ùˆ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</p>
                </div>
                
                <div class="flex items-center gap-4">
                    <!-- Global Search -->
                    <input type="text" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ ÙˆØ¸Ø§ÛŒÙ... (Ctrl+/)" class="global-search smart-search w-64">
                    
                    <!-- Quick Add Task -->
                    <button class="enhanced-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg" onclick="showTaskForm()">
                        <i class="fas fa-plus ml-2"></i>
                        ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯
                    </button>
                    
                    <!-- Bulk Actions -->
                    <button class="enhanced-btn bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-2 rounded-lg" onclick="showBulkActions()">
                        <i class="fas fa-layer-group ml-2"></i>
                        Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡ÛŒ
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Tasks Content -->
        <div class="page-content p-6">
            <!-- AI Insights -->
            <div class="ai-insights enhanced-card floating">
                <h3 class="sidebar-title">
                    <i class="fas fa-brain"></i>
                    Ø¨ÛŒÙ†Ø´â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                </h3>
                <div class="insight-item">
                    <div class="insight-icon">âš ï¸</div>
                    <div class="insight-content">
                        <div class="insight-title">ÙˆØ¸Ø§ÛŒÙ ÙÙˆØ±ÛŒ</div>
                        <div class="insight-description">Û³ ÙˆØ¸ÛŒÙÙ‡ Ø¨Ø§ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆØ¬Ù‡ ÙÙˆØ±ÛŒ Ø¯Ø§Ø±Ù†Ø¯</div>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">ğŸ“ˆ</div>
                    <div class="insight-content">
                        <div class="insight-title">Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø§ÛŒÙ† Ù‡ÙØªÙ‡</div>
                        <div class="insight-description">Û²Û³Ùª Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù‡ÙØªÙ‡ Ù‚Ø¨Ù„ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª</div>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">ğŸ¯</div>
                    <div class="insight-content">
                        <div class="insight-title">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ</div>
                        <div class="insight-description">ÙˆØ¸Ø§ÛŒÙ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† VIP Ø¯Ø± Ø§ÙˆÙ„ÙˆÛŒØª Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ù†Ø¯</div>
                    </div>
                </div>
            </div>
            
            <!-- Tasks Container -->
            <div class="tasks-container">
                <!-- Main Tasks Board -->
                <div class="tasks-main enhanced-card">
                    <!-- Task Filters -->
                    <div class="task-filters">
                        <button class="filter-btn active" onclick="filterTasks('all')" id="filterAll">
                            Ù‡Ù…Ù‡ ÙˆØ¸Ø§ÛŒÙ
                        </button>
                        <button class="filter-btn" onclick="filterTasks('pending')" id="filterPending">
                            Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
                        </button>
                        <button class="filter-btn" onclick="filterTasks('in-progress')" id="filterInProgress">
                            Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…
                        </button>
                        <button class="filter-btn" onclick="filterTasks('completed')" id="filterCompleted">
                            ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
                        </button>
                        <button class="filter-btn" onclick="filterTasks('overdue')" id="filterOverdue">
                            Ø¹Ù‚Ø¨ Ø§ÙØªØ§Ø¯Ù‡
                        </button>
                        <button class="filter-btn" onclick="filterTasks('high-priority')" id="filterHighPriority">
                            Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§
                        </button>
                    </div>
                    
                    <!-- Task Board -->
                    <div class="task-board" id="taskBoard">
                        <!-- Task columns will be generated here -->
                    </div>
                </div>
                
                <!-- Tasks Sidebar -->
                <div class="tasks-sidebar">
                    <!-- Task Stats -->
                    <div class="sidebar-section">
                        <h4 class="sidebar-title">
                            <i class="fas fa-chart-pie"></i>
                            Ø¢Ù…Ø§Ø± ÙˆØ¸Ø§ÛŒÙ
                        </h4>
                        <div class="task-stats">
                            <div class="stat-card">
                                <div class="stat-value">Û²Û´</div>
                                <div class="stat-label">Ú©Ù„ ÙˆØ¸Ø§ÛŒÙ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">Û¸</div>
                                <div class="stat-label">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">Û±Û²</div>
                                <div class="stat-label">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">Û´</div>
                                <div class="stat-label">Ø¹Ù‚Ø¨ Ø§ÙØªØ§Ø¯Ù‡</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="sidebar-section">
                        <h4 class="sidebar-title">
                            <i class="fas fa-bolt"></i>
                            Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø±ÛŒØ¹
                        </h4>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="quickAction('task')">
                                <i class="fas fa-tasks"></i>
                                ÙˆØ¸ÛŒÙÙ‡
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('meeting')">
                                <i class="fas fa-handshake"></i>
                                Ø¬Ù„Ø³Ù‡
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('call')">
                                <i class="fas fa-phone"></i>
                                ØªÙ…Ø§Ø³
                            </button>
                            <button class="quick-action-btn" onclick="quickAction('reminder')">
                                <i class="fas fa-bell"></i>
                                ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- AI Assistant Button -->
    <div class="ai-assistant-button" onclick="crm.toggleAIAssistant()">
        ğŸ¤–
    </div>
    
    <!-- Task Form Modal -->
    <div id="taskFormModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="task-form w-full max-w-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯</h3>
                    <button onclick="hideTaskForm()" class="text-white text-2xl hover:text-red-400">
                        Ã—
                    </button>
                </div>
                
                <form id="taskForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¹Ù†ÙˆØ§Ù† ÙˆØ¸ÛŒÙÙ‡</label>
                            <input type="text" class="form-input" name="title" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÙˆØ¶Ø¹ÛŒØª</label>
                            <select class="form-select" name="status">
                                <option value="pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                                <option value="in-progress">Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…</option>
                                <option value="completed">ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
                        <textarea class="form-input form-textarea" name="description"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÛŒØ® ØªØ­ÙˆÛŒÙ„</label>
                            <input type="date" class="form-input" name="dueDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§ÙˆÙ„ÙˆÛŒØª</label>
                            <select class="form-select" name="priority">
                                <option value="low">Ù¾Ø§ÛŒÛŒÙ†</option>
                                <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                                <option value="high">Ø¨Ø§Ù„Ø§</option>
                                <option value="urgent">ÙÙˆØ±ÛŒ</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ø´ØªØ±ÛŒ Ù…Ø±ØªØ¨Ø·</label>
                            <select class="form-select" name="customer">
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ...</option>
                                <option value="1">Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ</option>
                                <option value="2">Ø²Ù‡Ø±Ø§ Ù…Ø­Ù…Ø¯ÛŒ</option>
                                <option value="3">Ø­Ø³ÛŒÙ† Ø±Ø¶Ø§ÛŒÛŒ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§</label>
                            <input type="text" class="form-input" name="tags" placeholder="Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ù¾ÛŒØ´Ø±ÙØª (%)</label>
                        <input type="range" class="form-input" name="progress" min="0" max="100" value="0">
                        <div class="text-center text-white mt-2">
                            <span id="progressValue">Û°Ùª</span>
                        </div>
                    </div>
                </form>
                
                <div class="flex justify-end gap-4 mt-6">
                    <button onclick="hideTaskForm()" class="enhanced-btn bg-gray-500 text-white px-6 py-2 rounded-lg">
                        Ø§Ù†ØµØ±Ø§Ù
                    </button>
                    <button onclick="saveTask()" class="enhanced-btn bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-2 rounded-lg">
                        <i class="fas fa-save ml-2"></i>
                        Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¸ÛŒÙÙ‡
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Main Script -->
    <script src="enhanced-main.js"></script>
    
    <script>
        // Tasks state
        let tasks = [];
        let currentFilter = 'all';
        let draggedTask = null;
        
        // Task columns
        const columns = [
            { id: 'pending', title: 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±', icon: 'fas fa-clock' },
            { id: 'in-progress', title: 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…', icon: 'fas fa-spinner' },
            { id: 'completed', title: 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡', icon: 'fas fa-check-circle' }
        ];
        
        // Initialize tasks page
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleTasks();
            renderTaskBoard();
            initializeTypedText();
            setupDragAndDrop();
            updateProgressSlider();
        });
        
        function loadSampleTasks() {
            tasks = [
                {
                    id: 1,
                    title: 'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯',
                    description: 'ØªÙ…Ø§Ø³ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª',
                    status: 'pending',
                    priority: 'high',
                    dueDate: new Date(2023, 10, 16),
                    customer: '1',
                    progress: 0,
                    tags: ['ÙØ±ÙˆØ´', 'ØªÙ…Ø§Ø³ Ø§ÙˆÙ„ÛŒÙ‡'],
                    createdAt: new Date(2023, 10, 14)
                },
                {
                    id: 2,
                    title: 'Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ±',
                    description: 'Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ´â€ŒÙØ§Ú©ØªÙˆØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯',
                    status: 'in-progress',
                    priority: 'medium',
                    dueDate: new Date(2023, 10, 18),
                    customer: '2',
                    progress: 60,
                    tags: ['ÙØ§Ú©ØªÙˆØ±', 'Ù¾Ø±ÙˆÚ˜Ù‡'],
                    createdAt: new Date(2023, 10, 13)
                },
                {
                    id: 3,
                    title: 'Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª',
                    description: 'Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø³ÙØ§Ø±Ø´Ø§Øª Ù‚Ø¨Ù„ÛŒ Ùˆ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ­ÙˆÛŒÙ„',
                    status: 'completed',
                    priority: 'low',
                    dueDate: new Date(2023, 10, 14),
                    customer: '1',
                    progress: 100,
                    tags: ['Ù¾ÛŒÚ¯ÛŒØ±ÛŒ', 'Ø³ÙØ§Ø±Ø´'],
                    createdAt: new Date(2023, 10, 12)
                },
                {
                    id: 4,
                    title: 'Ø¢Ù¾Ø¯ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ',
                    description: 'Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ Ùˆ Ù…Ø´Ø®ØµØ§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†',
                    status: 'pending',
                    priority: 'medium',
                    dueDate: new Date(2023, 10, 20),
                    customer: '',
                    progress: 0,
                    tags: ['Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ', 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª'],
                    createdAt: new Date(2023, 10, 15)
                },
                {
                    id: 5,
                    title: 'Ø¬Ù„Ø³Ù‡ Ø¨Ø§ ØªÛŒÙ… ÙØ±ÙˆØ´',
                    description: 'Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø¬Ù„Ø³Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø¨Ø§ ØªÛŒÙ… ÙØ±ÙˆØ´',
                    status: 'in-progress',
                    priority: 'high',
                    dueDate: new Date(2023, 10, 17),
                    customer: '',
                    progress: 30,
                    tags: ['Ø¬Ù„Ø³Ù‡', 'ØªÛŒÙ…'],
                    createdAt: new Date(2023, 10, 14)
                },
                {
                    id: 6,
                    title: 'Ø¢Ù…ÙˆØ²Ø´ Ú©Ø§Ø±Ú©Ù†Ø§Ù† Ø¬Ø¯ÛŒØ¯',
                    description: 'Ø¢Ù…ÙˆØ²Ø´ Ú©Ø§Ø±Ú©Ù†Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ ÙØ±Ø¢ÛŒÙ†Ø¯Ù‡Ø§',
                    status: 'pending',
                    priority: 'medium',
                    dueDate: new Date(2023, 10, 25),
                    customer: '',
                    progress: 0,
                    tags: ['Ø¢Ù…ÙˆØ²Ø´', 'Ú©Ø§Ø±Ú©Ù†Ø§Ù†'],
                    createdAt: new Date(2023, 10, 10)
                },
                {
                    id: 7,
                    title: 'Ø¨Ø±Ø±Ø³ÛŒ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´',
                    description: 'ØªØ­Ù„ÛŒÙ„ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ùˆ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ ÙØ±ØµØªâ€ŒÙ‡Ø§',
                    status: 'in-progress',
                    priority: 'high',
                    dueDate: new Date(2023, 10, 19),
                    customer: '',
                    progress: 75,
                    tags: ['Ú¯Ø²Ø§Ø±Ø´', 'ØªØ­Ù„ÛŒÙ„'],
                    createdAt: new Date(2023, 10, 12)
                },
                {
                    id: 8,
                    title: 'ØªÙ…Ø§Ø³ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ',
                    description: 'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒØ§Ù† Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø±Ø¶Ø§ÛŒØª',
                    status: 'completed',
                    priority: 'low',
                    dueDate: new Date(2023, 10, 13),
                    customer: '3',
                    progress: 100,
                    tags: ['Ù¾ÛŒÚ¯ÛŒØ±ÛŒ', 'Ø±Ø¶Ø§ÛŒØª'],
                    createdAt: new Date(2023, 10, 11)
                }
            ];
        }
        
        function renderTaskBoard() {
            const board = document.getElementById('taskBoard');
            board.innerHTML = '';
            
            columns.forEach(column => {
                const columnElement = document.createElement('div');
                columnElement.className = 'task-column';
                columnElement.id = `column-${column.id}`;
                
                const filteredTasks = getFilteredTasks(column.id);
                
                columnElement.innerHTML = `
                    <div class="column-header">
                        <div class="column-title">
                            <i class="${column.icon}"></i>
                            ${column.title}
                        </div>
                        <div class="task-count">${filteredTasks.length}</div>
                        <button class="add-task-btn" onclick="addTaskToColumn('${column.id}')">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="task-list" data-status="${column.id}">
                        ${filteredTasks.map(task => renderTaskCard(task)).join('')}
                    </div>
                `;
                
                board.appendChild(columnElement);
            });
        }
        
        function getFilteredTasks(status) {
            let filteredTasks = tasks.filter(task => task.status === status);
            
            // Apply additional filters
            if (currentFilter !== 'all') {
                switch (currentFilter) {
                    case 'overdue':
                        filteredTasks = filteredTasks.filter(task => isOverdue(task.dueDate));
                        break;
                    case 'high-priority':
                        filteredTasks = filteredTasks.filter(task => task.priority === 'high' || task.priority === 'urgent');
                        break;
                    default:
                        // Other filters are already handled by status
                        break;
                }
            }
            
            return filteredTasks;
        }
        
        function renderTaskCard(task) {
            const isOverdueTask = isOverdue(task.dueDate);
            const isTodayTask = isToday(task.dueDate);
            
            return `
                <div class="task-card ${task.priority}-priority" draggable="true" data-task-id="${task.id}">
                    <div class="task-actions">
                        <button class="task-action-btn" onclick="editTask(${task.id})" title="ÙˆÛŒØ±Ø§ÛŒØ´">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="task-action-btn" onclick="deleteTask(${task.id})" title="Ø­Ø°Ù">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <input type="checkbox" class="task-checkbox" ${task.status === 'completed' ? 'checked' : ''} onchange="toggleTaskCompletion(${task.id})">
                    </div>
                    
                    <div class="task-description">${task.description}</div>
                    
                    <div class="task-meta">
                        ${task.customer ? `<div class="task-customer">${getCustomerName(task.customer)}</div>` : '<div></div>'}
                        <div class="task-due-date ${isOverdueTask ? 'overdue' : isTodayTask ? 'today' : ''}">
                            <i class="fas fa-calendar"></i>
                            ${formatDate(task.dueDate)}
                        </div>
                    </div>
                    
                    ${task.progress > 0 ? `
                        <div class="task-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${task.progress}%"></div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${task.tags.length > 0 ? `
                        <div class="task-tags">
                            ${task.tags.map(tag => `<span class="task-tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function isOverdue(date) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return date < today;
        }
        
        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('fa-IR', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function getCustomerName(customerId) {
            const customers = {
                '1': 'Ø¹Ù„ÛŒ Ø§Ø­Ù…Ø¯ÛŒ',
                '2': 'Ø²Ù‡Ø±Ø§ Ù…Ø­Ù…Ø¯ÛŒ',
                '3': 'Ø­Ø³ÛŒÙ† Ø±Ø¶Ø§ÛŒÛŒ'
            };
            return customers[customerId] || 'Ø¨Ø¯ÙˆÙ† Ù…Ø´ØªØ±ÛŒ';
        }
        
        function filterTasks(filter) {
            currentFilter = filter;
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1).replace('-', '')}`).classList.add('active');
            
            renderTaskBoard();
            
            if (crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation(`ÙÛŒÙ„ØªØ± Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯: ${filter === 'all' ? 'Ù‡Ù…Ù‡ ÙˆØ¸Ø§ÛŒÙ' : filter}`);
            }
        }
        
        function toggleTaskCompletion(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                if (task.status === 'completed') {
                    task.status = 'pending';
                    task.progress = 0;
                } else {
                    task.status = 'completed';
                    task.progress = 100;
                }
                renderTaskBoard();
                
                if (crm && crm.showSuccessAnimation) {
                    crm.showSuccessAnimation(`ÙˆØ¸ÛŒÙÙ‡ ${task.status === 'completed' ? 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯' : 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª pending'}`);
                }
            }
        }
        
        function setupDragAndDrop() {
            // Add drag and drop event listeners
            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragover', handleDragOver);
            document.addEventListener('drop', handleDrop);
            document.addEventListener('dragend', handleDragEnd);
        }
        
        function handleDragStart(e) {
            if (e.target.classList.contains('task-card')) {
                draggedTask = parseInt(e.target.dataset.taskId);
                e.target.style.opacity = '0.5';
            }
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            const taskList = e.target.closest('.task-list');
            if (taskList) {
                taskList.style.backgroundColor = 'rgba(139, 92, 246, 0.1)';
            }
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const taskList = e.target.closest('.task-list');
            if (taskList && draggedTask) {
                const newStatus = taskList.dataset.status;
                const task = tasks.find(t => t.id === draggedTask);
                if (task && task.status !== newStatus) {
                    task.status = newStatus;
                    if (newStatus === 'completed') {
                        task.progress = 100;
                    }
                    renderTaskBoard();
                    
                    if (crm && crm.showSuccessAnimation) {
                        crm.showSuccessAnimation(`ÙˆØ¸ÛŒÙÙ‡ Ø¨Ù‡ ${newStatus} Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯`);
                    }
                }
            }
        }
        
        function handleDragEnd(e) {
            if (e.target.classList.contains('task-card')) {
                e.target.style.opacity = '1';
                draggedTask = null;
                
                // Reset background colors
                document.querySelectorAll('.task-list').forEach(list => {
                    list.style.backgroundColor = '';
                });
            }
        }
        
        function showTaskForm() {
            document.getElementById('taskFormModal').classList.remove('hidden');
            
            // Set default due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.querySelector('input[name="dueDate"]').value = tomorrow.toISOString().split('T')[0];
            
            // Add animation
            anime({
                targets: '#taskFormModal .task-form',
                scale: [0.8, 1],
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutCubic'
            });
        }
        
        function hideTaskForm() {
            anime({
                targets: '#taskFormModal .task-form',
                scale: [1, 0.8],
                opacity: [1, 0],
                duration: 300,
                easing: 'easeInCubic',
                complete: () => {
                    document.getElementById('taskFormModal').classList.add('hidden');
                    document.getElementById('taskForm').reset();
                }
            });
        }
        
        function updateProgressSlider() {
            const slider = document.querySelector('input[name="progress"]');
            const valueDisplay = document.getElementById('progressValue');
            
            if (slider && valueDisplay) {
                slider.addEventListener('input', function() {
                    valueDisplay.textContent = this.value + 'Ùª';
                });
            }
        }
        
        function saveTask() {
            const form = document.getElementById('taskForm');
            const formData = new FormData(form);
            const taskData = Object.fromEntries(formData.entries());
            
            // Validate form
            if (!taskData.title || !taskData.dueDate) {
                if (crm && crm.showErrorAnimation) {
                    crm.showErrorAnimation('Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                }
                return;
            }
            
            // Add new task
            const newTask = {
                id: tasks.length + 1,
                title: taskData.title,
                description: taskData.description || '',
                status: taskData.status,
                priority: taskData.priority,
                dueDate: new Date(taskData.dueDate),
                customer: taskData.customer || '',
                progress: parseInt(taskData.progress) || 0,
                tags: taskData.tags ? taskData.tags.split(',').map(tag => tag.trim()) : [],
                createdAt: new Date()
            };
            
            tasks.push(newTask);
            renderTaskBoard();
            hideTaskForm();
            
            if (crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation('ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯');
            }
        }
        
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation(`ÙˆÛŒØ±Ø§ÛŒØ´ ÙˆØ¸ÛŒÙÙ‡: ${task.title}`);
            }
        }
        
        function deleteTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ÙˆØ¸ÛŒÙÙ‡ "${task.title}" Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                tasks = tasks.filter(t => t.id !== taskId);
                renderTaskBoard();
                
                if (crm && crm.showSuccessAnimation) {
                    crm.showSuccessAnimation('ÙˆØ¸ÛŒÙÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
                }
            }
        }
        
        function addTaskToColumn(status) {
            showTaskForm();
            
            // Pre-select status
            setTimeout(() => {
                const statusSelect = document.querySelector('select[name="status"]');
                statusSelect.value = status;
            }, 100);
            
            if (crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation(`Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± ${status}`);
            }
        }
        
        function quickAction(type) {
            showTaskForm();
            
            // Set default values based on type
            setTimeout(() => {
                const titleInput = document.querySelector('input[name="title"]');
                const prioritySelect = document.querySelector('select[name="priority"]');
                
                switch(type) {
                    case 'task':
                        titleInput.placeholder = 'Ø¹Ù†ÙˆØ§Ù† ÙˆØ¸ÛŒÙÙ‡ Ø¬Ø¯ÛŒØ¯...';
                        break;
                    case 'meeting':
                        titleInput.value = 'Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯';
                        prioritySelect.value = 'high';
                        break;
                    case 'call':
                        titleInput.value = 'ØªÙ…Ø§Ø³ ØªÙ„ÙÙ†ÛŒ';
                        prioritySelect.value = 'medium';
                        break;
                    case 'reminder':
                        titleInput.value = 'ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ';
                        prioritySelect.value = 'low';
                        break;
                }
            }, 100);
            
            if (crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation(`Ø§ÛŒØ¬Ø§Ø¯ ${type} Ø¬Ø¯ÛŒØ¯`);
            }
        }
        
        function showBulkActions() {
            if (crm && crm.showSuccessAnimation) {
                crm.showSuccessAnimation('Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯');
            }
        }
        
        function initializeTypedText() {
            const elements = document.querySelectorAll('.animate-text');
            
            elements.forEach((element, index) => {
                if (element.textContent.trim()) {
                    const typed = new Typed(element, {
                        strings: [element.textContent],
                        typeSpeed: 50,
                        showCursor: false,
                        onComplete: () => {
                            element.classList.add('typing-complete');
                        }
                    });
                }
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showTaskForm();
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                const searchInput = document.querySelector('.global-search');
                if (searchInput) {
                    searchInput.focus();
                    searchInput.select();
                }
            }
        });
        
        // Global functions
        window.showTaskForm = showTaskForm;
        window.hideTaskForm = hideTaskForm;
        window.saveTask = saveTask;
        window.editTask = editTask;
        window.deleteTask = deleteTask;
        window.filterTasks = filterTasks;
        window.addTaskToColumn = addTaskToColumn;
        window.quickAction = quickAction;
        window.showBulkActions = showBulkActions;
    </script>
</body>
</html>